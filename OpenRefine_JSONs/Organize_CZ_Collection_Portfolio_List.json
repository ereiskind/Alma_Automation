[
    {
        "op": "core/column-reorder",
        "columnNames": [
            "Portfolio ID",
            "title",
            "Collection ID",
            "Identifier",
            "Identifier (extd.)"
        ],
        "description": "Reorder columns to leave just the portfolio ID, collection ID, title, and ISBNs"
    },
    {
        "op": "core/transpose-columns-into-rows",
        "combinedColumnName": "ISBN",
        "startColumnName": "Identifier",
        "columnCount": -1,
        "ignoreBlankCells": true,
        "fillDown": true,
        "prependColumnName": false,
        "separator": ":",
        "keyColumnName": null,
        "valueColumnName": null,
        "description": "Pivot the ISBN columns into one new column named ``ISBN``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "ISBN",
        "expression": "grel:replace(value,\"-\",\"\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Remove hyphens from values in column ``ISBN``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "ISBN",
        "expression": "grel:if(value.find(/^[\\d\\s]*/)[0].trim().indexOf(\" \")!=-1,value.find(/^[\\d\\s]*/)[0].trim().replace(\" \",\"\")+value.substring(value.find(/^[\\d\\s]*/)[0].trim().length()),value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Remove any spaces within the ISBN number itself in the column ``ISBN``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "ISBN",
                    "expression": "grel:or(value.length()==10,value.length()==13)",
                    "columnName": "ISBN",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "ISBN",
        "expression": "grel:if(value.indexOf(\" \")>0,if(value.indexOf(\"(\")>0,value.substring(0,min(value.indexOf(\" \"),value.indexOf(\"(\"))),value.split(\" \")[0]),if(value.indexOf(\"(\")>0,value.split(\"(\")[0],if(value.length()==9,\"0\"+value,value)))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For ISBN values not 10 or 13 digits long, remove any content after a space or opening parenthesis; if ISBN is only nine digits, add a zero to the front"
    },
    {
        "op": "core/column-addition",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "baseColumnName": "Portfolio ID",
        "expression": "grel:value+cells[\"Collection ID\"].value+cells.ISBN.value",
        "onError": "set-to-blank",
        "newColumnName": "Dedupe",
        "columnInsertIndex": 1,
        "description": "Create column ``Dedupe`` combining portfolio ID, collection ID, and ISBN"
    },
    {
        "op": "core/blank-down",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Dedupe",
        "description": "Blank down cells in column ``Dedupe``"
    },
    {
        "op": "core/row-removal",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Dedupe",
                    "expression": "isBlank(value)",
                    "columnName": "Dedupe",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "description": "Remove rows with no value in ``Dedupe``"
    },
    {
        "op": "core/column-removal",
        "columnName": "Dedupe",
        "description": "Remove column ``Dedupe``"
    }
]