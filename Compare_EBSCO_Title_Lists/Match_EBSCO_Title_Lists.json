[
    {
        "op": "core/column-rename",
        "oldColumnName": "User Access Model",
        "newColumnName": "ECM",
        "description": "Rename column ``User Access Model`` to ``ECM``"
    },
    {
        "op": "core/blank-down",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Book ID",
        "description": "Blank down cells in column ``Book ID``"
    },
    {
        "op": "core/blank-down",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "EBSCOadmin",
        "description": "Blank down cells in column ``EBSCOadmin``"
    },
    {
        "op": "core/multivalued-cell-split",
        "columnName": "EBSCOadmin",
        "keyColumnName": "Book ID",
        "mode": "separator",
        "separator": "}|{",
        "regex": false,
        "description": "Split column ``EBSCOadmin`` into new rows at `}|{`"
    },
    {
        "op": "core/column-addition",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "baseColumnName": "EBSCOadmin",
        "expression": "grel:if(value==cells.ECM.value,value,null)",
        "onError": "set-to-blank",
        "newColumnName": "User Access Model",
        "columnInsertIndex": 1,
        "description": "Create column ``User Access Model`` with the user access models for titles with a single user access model where both title lists had exactly the same user access model"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(filter(forEachIndex(row.record.cells[\"EBSCOadmin\"].value,i,EBSCOadmin,row.record.cells[\"ECM\"].value[i]==EBSCOadmin),bool,bool).length()==row.record.toRowIndex-row.record.fromRowIndex,cells.ECM.value,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with multiple user access models where both title lists had exactly the same user access models, add those user access models to column ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "User Access Model",
                    "expression": "grel:or(isNull(cells.EBSCOadmin.value),isNull(cells.ECM.value))",
                    "columnName": "User Access Model",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:\"[single source] \"+if(isNull(cells.ECM.value),cells.EBSCOadmin.value,cells.ECM.value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with a single access model in one source and no access model in another source, add `[single source]` followed by the user access model provided to ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.startsWith(\"NL\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "ECM",
                    "expression": "grel:value.startsWith(\"NL\")",
                    "columnName": "ECM",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(cells.EBSCOadmin.value.contains(\"(??? days)\"),cells.ECM.value,if(cells.EBSCOadmin.value.match(/NL\\s\\(.{3}\\sdays\\s\\{.{3}\\sdays\\sx(\\d*)\\}\\)/)[0]==cells.ECM.value.match(/NL\\s\\(.{3}\\sdays\\s\\{.{3}\\sdays\\sx(\\d*)\\}\\)/)[0],cells.ECM.value,\"[number of copies mismatch] NL (\"+cells.ECM.value.match(/NL\\s\\((.*)\\sdays.*/)[0]+\" days)\"))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with a single non-linear user access model in both title lists, if EBSCOadmin has a single copy (or at least one copy with the total number uncertain because of subscription access) and ECM has a single copy, or if EBSCOadmin and ECM have the same number of copies, add the access model statement with the number of copies and the number of days from ECM (as the EBSCOadmin title list doesn't have the number of days) to ``User Access Model``, otherwise, add `[number of copies mismatch] NL (<number> days)` to ``User Access Model`` where <number> is the number of days in the NL access model for the title"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.endsWith(\"^\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(cells.EBSCOadmin.value.contains(\"Consortium\")==cells.ECM.value.contains(\"Consortium\"),if(cells.EBSCOadmin.value.split(\" \")[0].find(/[1|3]U/).length()>0,if(isNull(cells.ECM.value.match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)),if(cells.ECM.value==cells.EBSCOadmin.value.substring(0,-1),cells.ECM.value,\"[access model mismatch]\"),if(cells.ECM.value.match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)[0]==cells.EBSCOadmin.value.substring(0,1),cells.ECM.value,\"[access model mismatch]\")),if(and(cells.ECM.value.startsWith(\"NL\"),cells.EBSCOadmin.value.startsWith(\"NL\")),cells.ECM.value,\"[access model mismatch]\")),\"[access model mismatch]\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with a single user access model where a non-perpetual access copy enabled unlimited access, if the user access models and consortial status match, add the user access model statement with the number of copies and the number of days if appropriate to ``User Access Model``, but if the access models don't match, add `[access model mismatch]` to ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.startsWith(\"UA\")",
                    "columnName": "EBSCOadmin",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.endsWith(\"^\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(filter(forEachIndex(row.record.cells[\"EBSCOadmin\"].value,i,EBSCOadmin,if(EBSCOadmin.contains(\"Consortium\")==row.record.cells[\"ECM\"].value[i].contains(\"Consortium\"),if(EBSCOadmin.split(\" \")[0].find(/[1|3]U/).length()>0,if(isNull(row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)),row.record.cells[\"ECM\"].value[i]==EBSCOadmin.substring(0,-1),row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)[0]==EBSCOadmin.substring(0,1)),row.record.cells[\"ECM\"].value[i].startsWith(\"NL\")),false)),bool,bool).length()==row.record.toRowIndex-row.record.fromRowIndex,cells.ECM.value,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with multiple user access models where a non-perpetual access copy meant EBSCOadmin displayed unlimited user access, if the user access models and consortial status match for all the access models, add the user access model statement with the number of copies and the number of days if appropriate to ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.startsWith(\"UA\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.endsWith(\"^\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(filter(forEachIndex(row.record.cells[\"EBSCOadmin\"].value,i,EBSCOadmin,if(EBSCOadmin.startsWith(\"UA\"),EBSCOadmin==row.record.cells[\"ECM\"].value[i],if(EBSCOadmin.contains(\"Consortium\")==row.record.cells[\"ECM\"].value[i].contains(\"Consortium\"),if(EBSCOadmin.split(\" \")[0].find(/[1|3]U/).length()>0,if(isNull(row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)),row.record.cells[\"ECM\"].value[i]==EBSCOadmin.substring(0,-1),row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)[0]==EBSCOadmin.substring(0,1)),and(EBSCOadmin.startsWith(\"NL\"),row.record.cells[\"ECM\"].value[i].startsWith(\"NL\"))),false))),bool,bool).length()==row.record.toRowIndex-row.record.fromRowIndex,cells.ECM.value,forEachIndex(row.record.cells[\"EBSCOadmin\"].value,i,EBSCOadmin,if(EBSCOadmin.startsWith(\"UA\")==row.record.cells[\"ECM\"].value[i].startsWith(\"UA\"),if(EBSCOadmin.startsWith(\"UA\"),if(EBSCOadmin.contains(\"Consortium\")==row.record.cells[\"ECM\"].value[i].contains(\"Consortium\"),\"ERROR\",\"[access model mismatch]\"),if(EBSCOadmin.contains(\"Consortium\")==row.record.cells[\"ECM\"].value[i].contains(\"Consortium\"),if(EBSCOadmin.split(\" \")[0].find(/[1|3]U/).length()>0,if(isNull(row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)),if(row.record.cells[\"ECM\"].value[i]==EBSCOadmin.substring(0,-1),row.record.cells[\"ECM\"].value[i]+\" [number of copies from ECM only]\",\"[access model mismatch]\"),if(row.record.cells[\"ECM\"].value[i].match(/.*\\{(\\d*)U\\sx(\\d*)\\}.*/)[0]==EBSCOadmin.substring(0,1),row.record.cells[\"ECM\"].value[i]+\" [number of copies from ECM only]\",\"[access model mismatch]\")),if(row.record.cells[\"ECM\"].value[i].startsWith(\"NL\"),row.record.cells[\"ECM\"].value[i]+\" [number of copies from ECM only]\",\"[access model mismatch]\")),\"[access model mismatch]\")),\"[access model mismatch]\"))[row.index-row.record.fromRowIndex])",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with multiple user access models where a perpetual access copy meant EBSCOadmin displayed unlimited user access, if the title lists agree on the consortial and DRM status of the unlimited access titles and the access model and consortial status of the other access model(s), add the user access model statement with the number of copies and the number of days if appropriate to ``User Access Model``, but if ECM doesn't indicate that one of the user access models for the title is unlimited access, put `[access model mismatch]` in ``User Access Model`` in the row where EBSCOadmin has an unlimited user access model and ECM doesn't and the user access model statement with the number of copies and the number of days if appropriate followed by  `[number of copies from ECM only]` in ``User Access Model`` in the rows where the access models match"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.startsWith(\"NL\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "ECM",
                    "expression": "grel:value.startsWith(\"NL\")",
                    "columnName": "ECM",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(filter(forEachIndex(row.record.cells[\"EBSCOadmin\"].value,i,EBSCOadmin,if(and(EBSCOadmin.startsWith(\"NL\"),row.record.cells[\"ECM\"].value[i].startsWith(\"NL\")),if(isNumeric(row.record.cells[\"ECM\"].value[i].match(/NL\\s\\((\\d*)\\sdays\\)/)),EBSCOadmin==\"NL (??? days)\",EBSCOadmin.match(/NL\\s\\(.{3}\\sdays\\s\\{.{3}\\sdays\\sx(\\d*)\\}\\)/)[0]==row.record.cells[\"ECM\"].value[i].match(/NL\\s\\(.{3}\\sdays\\s\\{.{3}\\sdays\\sx(\\d*)\\}\\)/)[0]),row.record.cells[\"ECM\"].value[i]==EBSCOadmin)),bool,bool).length()==row.record.toRowIndex-row.record.fromRowIndex,cells.ECM.value,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with multiple user access models, one of which is non-linear, if the non-linear access models from both title lists have the same number of copies and the other access models are exactly the same with the same number of copies, add the user access model statement with the number of copies and the number of days if appropriate to ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.endsWith(\"copies>\")",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:value.startsWith(\"1U\")",
                    "columnName": "EBSCOadmin",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": true
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(filter(forEach(row.record.cells[\"ECM\"].value,ECM,ECM.contains(\"{\")),bool,bool).length()==0,\"[number of copies mismatch] \"+cells.EBSCOadmin.value.match(/(.*)\\s<.*\\scopies>/)[0],if(forEach(forEach(row.record.cells[\"ECM\"].value,ECM,ECM.match(/.*(\\d+).*/)[0]),number,number.toNumber()).sum()==cells.EBSCOadmin.value.match(/.*\\s<(\\d*)\\-(\\d*)\\scopies>/)[1].toNumber()+(row.record.toRowIndex-row.record.fromRowIndex-1),cells.ECM.value,\"[number of copies mismatch] \"+cells.EBSCOadmin.value.match(/(.*)\\s<.*\\scopies>/)[0]))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles which have 1U and 1U Consortium access models but no others where the EBSCOadmin list provides the total number of copies for the title but not the number of copies for each access model, if the total number of copies matches in EBSCOadmin and ECM, add the user access model statement with the number of copies to ``User Access Model``, otherwise add  `[number of copies mismatch]` followed by the access model to ``User Access Model``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "EBSCOadmin",
                    "expression": "grel:forEach(row.record.cells[\"EBSCOadmin\"].value,EBSCOadmin,EBSCOadmin).length()==1",
                    "columnName": "EBSCOadmin",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "EBSCOadmin",
        "expression": "grel:if(forEach(row.record.cells[\"ECM\"].value,ECM,filter(row.record.cells[\"EBSCOadmin\"].value,EBSCOadmin,EBSCOadmin==ECM).length()).sum()>0,forEach(row.record.cells[\"ECM\"].value,ECM,filter(row.record.cells[\"EBSCOadmin\"].value,EBSCOadmin,EBSCOadmin==ECM))[row.index-row.record.fromRowIndex].join(\"\"),value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles where ECM has multiple access models but EBSCOadmin has only one, if the EBSCOadmin user access model is an exact match to one of the ECM user access models, move the user access model in ``EBSCOadmin`` to the same row as the user access model in ``ECM`` and place empty strings in all other rows"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "EBSCOadmin",
        "expression": "grel:if(isEmptyString(value),\"[null]\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change all the empty strings in ``EBSCOadmin`` to `[null]`"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "ECM",
                    "expression": "grel:forEach(row.record.cells[\"ECM\"].value,ECM,ECM).length()==1",
                    "columnName": "ECM",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "ECM",
        "expression": "grel:if(forEach(row.record.cells[\"EBSCOadmin\"].value,EBSCOadmin,filter(row.record.cells[\"ECM\"].value,ECM,ECM==EBSCOadmin).length()).sum()>0,forEach(row.record.cells[\"EBSCOadmin\"].value,EBSCOadmin,filter(row.record.cells[\"ECM\"].value,ECM,ECM==EBSCOadmin))[row.index-row.record.fromRowIndex].join(\"\"),value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles where EBSCOadmin has multiple access models but ECM has only one, if the ECM user access model is an exact match to one of the EBSCOadmin user access models, move the user access model in ``ECM`` to the same row as the user access model in ``EBSCOadmin`` and place empty strings in all other rows"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "ECM",
        "expression": "grel:if(isEmptyString(value),\"[null]\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change all the empty strings in ``ECM`` to `[null]`"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "User Access Model",
                    "expression": "grel:or(row.record.cells[\"EBSCOadmin\"].value.inArray(\"[null]\"),row.record.cells[\"ECM\"].value.inArray(\"[null]\"))",
                    "columnName": "User Access Model",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(cells.EBSCOadmin.value==cells.ECM.value,cells.ECM.value,\"[single source] \"+if(cells.ECM.value==\"[null]\",cells.EBSCOadmin.value,cells.ECM.value))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles where one source has multiple access models but the other source has a single user access model that's an exact match to one of the other source's user access models, add the matching user access model to ``User Access Model`` in its row and `[single source]` followed by the user access model in ``User Access Model`` in the rows where only one source had the given user access model"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "EBSCOadmin",
        "expression": "grel:if(value==\"[null]\",null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Null `[null]` values in column ``EBSCOadmin``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "ECM",
        "expression": "grel:if(value==\"[null]\",null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Null `[null]` values in column ``ECM``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "User Access Model",
                    "expression": "isBlank(value)",
                    "columnName": "User Access Model",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Book ID",
                    "expression": "isBlank(value)",
                    "columnName": "Book ID",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "User Access Model",
                    "expression": "grel:and(cells.ECM.value.find(/[1|3]U/).length()>0,cells.EBSCOadmin.value.find(/[1|3]U/).length()>0)",
                    "columnName": "User Access Model",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "User Access Model",
        "expression": "grel:if(cells.EBSCOadmin.value.contains(\"Consortium\")==cells.ECM.value.contains(\"Consortium\"),if(cells.ECM.value.match(/.*([1|3])U.*/)[0]==cells.EBSCOadmin.value.match(/.*([1|3])U.*/)[0],\"[number of copies mismatch] \"+cells.ECM.value.match(/.*([1|3]U).*/)[0]+if(cells.ECM.value.contains(\"Consortium\"),\" Consortium\",\"\"),\"[access model mismatch]\"),\"[access model mismatch]\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "For titles with a single one-user or three-user access model that haven't been matched yet, if the access models don't match, add `[access model mismatch]` to ``User Access Model``, and if the number of copies don't match, add `[number of copies mismatch]` followed by the access model to ``User Access Model``"
    }
]